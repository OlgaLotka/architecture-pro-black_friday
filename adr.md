### <a name="_b7urdng99y53"></a>**Название задачи:**  Добавление новых категорий товаров в  «Мобильный мир»
### <a name="_hjk0fkfyohdk"></a>**Автор:** Лотка О.А.
### <a name="_uanumrh8zrui"></a>**Дата:** 23.07.2025
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
| **№** | **Требование**                                                                                                                                                               |
|:-----:|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  F1   | Заказы. Быстрое создание заказов с одновременным списанием остатков                                                                                                          |
|  F2   | Заказы. Поиск истории заказов конкретного пользователя                                                                                                                       |
|  F3   | Заказы. Отображение статуса заказа                                                                                                                                           |
|  F4   | Товары. Частые обновления остатков при покупках.                                                                                                                             |
|  F5   | Товары. Поиск товаров по категориям и фильтрация по диапазону цен                                                                                                            |
|  F6   | Товары. Описание товара на странице продукта                                                                                                                                 |
|  F7   | Корзина. Создание корзины, когда заходит гость или новый пользователь. Получение текущей корзины по фильтру { session_id, status:"active" } или { user_id, status:"active" } |
|  F8   | Корзина. Добавление или замена товара в корзине                                                                                                                              |
|  F9   | Корзина. Удаление товара из корзины                                                                                                                                          |
|  F10  | Корзина. Слияние гостевой корзины в пользовательскую, если пользователь залогинится                                                                                          |
|  F11  | Корзина. Отметка корзины как заказанной                                                                                                                                      |

### <a name="_qmphm5d6rvi3"></a>**Решение**
[Диаграмма коллекций](task7.drawio)
Шардирование реализовать по геозоне для всех колекций.
Коллекция Товары (products). Диапазонное шардирование по цене - это позволит ускорить поиск по товарам
```shell
db.adminCommand({ shardCollection: "database.products", key: { "price": "price" },
    balancing: true,
    chunkMetadata: { shard: 'my-mongo-mongodb-sharded-shard-1', nChunks: 3 },
    chunks: [
      {
        min: { price: MinKey() },
        max: { price: 1000},
        'on shard': 'my-mongo-mongodb-sharded-shard-1',
        'last modified': Timestamp(2, 1)
      },
      {
        min: { price: 1001},
        max: { price: MaxKey() },
        'on shard': 'my-mongo-mongodb-sharded-shard-0',
        'last modified': Timestamp(0, 2)
      }
    ],
    tags: [
      { tag: 'TSR1', min: { price: MinKey() }, max: { price: 1000} },
      { tag: 'TSR2', min: { price: 1001 }, max: { price: MaxKey() } }
    ] })
```
Коллекция Заказы (orders) Хэшированное шардирование по идентификатору клиента - клиента позволит равномерно распределить данные
```shell
db.adminCommand({ shardCollection: "database.orders", key: { "clientId": "hashed" } })
```
### <a name="_bjrr7veeh80c"></a>**Альтернативы**